<!-- ============================================ -->
<!-- BILLING MANAGEMENT PAGE -->
<!-- File: views/billing/manageBilling.ejs -->
<!-- Description: Displays billing records -->
<!-- ============================================ -->

<%- include('../partials/header') %>
<%- include('../partials/loader') %>
<%- include('../partials/sidebar') %>
<%- include('../partials/topbar') %>

<div class="container-fluid content-inner mt-4">
	<div class="row">
		<div class="col-sm-12">
			<div class="card">
				<div class="card-header d-flex justify-content-between align-items-center">
					<h3 class="card-title">
						<div class="breadcrumb1 flat">
							<a href="/dashboard"><span class="fa fa-home"></span></a>
							<a href="/billing" class="active"><%= __('sidebar.billing') %></a>
						</div>
					</h3>
				</div>
				<div class="card-body">
					<div class="table-responsive">
						<table id="billingTable" class="table table-hover small-text" style="width:100%">
							<thead>
								<tr>
									<th><%= __('billing.order_no') %></th>
											<% if (parseInt(permissions) === 1 && !branch_id) { %>
											<th>Branch</th>
											<% } %>
									<th><%= __('billing.payment_method') %></th>
									<th><%= __('billing.amount_due') %></th>
									<th><%= __('billing.amount_paid') %></th>
									<th><%= __('billing.payment_ref') %></th>
									<th><%= __('billing.status') %></th>
									<th><%= __('billing.encoded_at') %></th>
									<th><%= __('billing.encoded_by') %></th>
									<th class="text-center"><%= __('billing.payments') %></th>
									<th class="text-center"><%= __('billing.actions') %></th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="modal-payment" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="payment_form">
				<input type="hidden" id="payment_order_id">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title" id="paymentModalLabel"><%= __('billing.process_payment') %> - <span id="payment_order_no"></span></h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="row g-3">
						<div class="col-12">
							<div class="p-3 bg-light rounded border mb-3">
								<div class="d-flex justify-content-between mb-1">
									<span class="text-muted"><%= __('billing.amount_due_label') %>:</span>
									<span class="fw-bold text-dark" id="display_amount_due">0.00</span>
								</div>
								<div class="d-flex justify-content-between">
									<span class="text-muted"><%= __('billing.balance') %>:</span>
									<span class="fw-bold text-danger" id="display_balance">0.00</span>
								</div>
							</div>
						</div>
						<div class="col-md-12">
							<label class="form-label"><%= __('billing.payment_method_label') %></label>
							<select class="form-control" id="payment_method" required>
								<option value="CASH">CASH</option>
								<option value="GCASH">GCASH</option>
								<option value="MAYA">MAYA</option>
								<option value="CARD">CARD</option>
							</select>
						</div>
						<div class="col-md-12">
							<label class="form-label"><%= __('billing.amount_paid_label') %></label>
							<div class="input-group">
								<span class="input-group-text">â‚±</span>
								<input type="number" step="0.01" min="0" class="form-control fw-bold" id="amount_paid" placeholder="<%= __('billing.input_amount_placeholder') %>" required>
							</div>
						</div>
						<div class="col-12">
							<label class="form-label"><%= __('billing.payment_reference') %></label>
							<input type="text" class="form-control" id="payment_ref" placeholder="<%= __('billing.payment_reference_placeholder') %>">
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= __('billing.cancel') %></button>
					<button type="submit" class="btn btn-primary"><%= __('billing.save_payment') %></button>
				</div>
			</form>
		</div>
	</div>
</div>

<!-- Payment History Modal -->
<div class="modal fade" id="modal-payment-history" tabindex="-1" aria-labelledby="paymentHistoryLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header bg-dark text-white">
				<h5 class="modal-title" id="paymentHistoryLabel"><%= __('billing.payment_breakdown') %> - <span id="payment_history_order_no"></span></h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="table-responsive">
					<table class="table table-sm table-striped" id="paymentHistoryTable" style="width:100%">
						<thead>
							<tr>
								<th><%= __('billing.date') %></th>
								<th><%= __('billing.method') %></th>
								<th><%= __('billing.amount') %></th>
								<th><%= __('billing.reference') %></th>
								<th><%= __('billing.encoded_by') %></th>
							</tr>
						</thead>
						<tbody></tbody>
					</table>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= __('billing.close') %></button>
			</div>
		</div>
	</div>
</div>

<%- include('../partials/footer') %>
<!-- Translations passed via data attribute to avoid linter issues -->
<div id="billingTranslations" 
	data-paid="<%- __('billing.paid') %>" 
	data-partial="<%- __('billing.partial') %>"
	data-unpaid="<%- __('billing.unpaid') %>"
	data-settled="<%- __('billing.settled') %>"
	data-view="<%- __('billing.view') %>"
	data-pay="<%- __('billing.pay') %>"
	data-loading="<%- __('billing.loading') %>"
	data-no-payments-found="<%- __('billing.no_payments_found') %>"
	data-failed-to-load-payments="<%- __('billing.failed_to_load_payments') %>"
	data-success="<%- __('billing.success') %>"
	data-payment-processed-successfully="<%- __('billing.payment_processed_successfully') %>"
	data-error="<%- __('billing.error') %>"
	data-failed-to-process-payment="<%- __('billing.failed_to_process_payment') %>"
	data-unable-to-load-billing-records="<%- __('billing.unable_to_load_billing_records') %>"
	data-unknown="<%- __('billing.unknown') %>"
	data-n-a="<%- __('billing.n_a') %>"
	data-pagination-showing="<%- __('billing.pagination.showing') %>"
	data-pagination-to="<%- __('billing.pagination.to') %>"
	data-pagination-of="<%- __('billing.pagination.of') %>"
	data-pagination-entries="<%- __('billing.pagination.entries') %>"
	data-pagination-previous="<%- __('billing.pagination.previous') %>"
	data-pagination-next="<%- __('billing.pagination.next') %>"
	data-pagination-search="<%- __('billing.pagination.search') %>"
	data-pagination-search-placeholder="<%- __('billing.pagination.search_placeholder') %>"
	style="display: none;"></div>

<!-- Billing context for admin branch checks -->
<div id="billingContextData"
	data-permissions="<%= (typeof permissions !== 'undefined' && permissions !== null) ? permissions : 0 %>"
	data-branch-id="<%= (typeof branch_id !== 'undefined' && branch_id !== null) ? branch_id : '' %>"
	style="display: none;"></div>
<script src="/assets/js/functions/manageBilling.js?v=2026-01-21-branch"></script>
<style>
	.card-body {
		overflow-x: auto;
	}

	#billingTable th {
		font-size: 12px;
		font-weight: 600;
	}
</style>
