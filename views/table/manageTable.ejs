<!-- ============================================ -->
<!-- TABLE MANAGEMENT PAGE -->
<!-- File: views/table/manageTable.ejs -->
<!-- Description: Main page for managing restaurant tables -->
<!-- ============================================ -->

<%- include('../partials/header') %>
<%- include('../partials/loader') %>
	<%- include('../partials/sidebar') %>

		<%- include('../partials/topbar') %>

			<div class="container-fluid content-inner mt-4">
				<div class="row">
					<div class="col-sm-12">
						<div class="card">
							<div class="card-header d-flex justify-content-between align-items-center">
								<h3 class="card-title"><div class="breadcrumb1 flat">
									<a href="/dashboard" ><span class="fa fa-home"></span></a>
									<a href="/manageTable"class="active"><%= __('table.manage_restaurant_tables') %></a>
								</div></h3>
									<button type="button" class="btn btn-primary" onclick="add_restaurant_table_modal()">
										<i class="fa fa-plus" aria-hidden="true"></i> <%= __('table.new_table') %>
									</button>
							</div>

							<!-- ============================================ -->
							<!-- FILTERS SECTION -->
							<!-- ============================================ -->
							<div class="card-body border-bottom bg-light py-2">
								<div class="row g-2 align-items-center">
									<div class="col-auto">
										<label class="form-label fw-bold mb-0" style="font-size: 12px;"><%= __('table.status') %>:</label>
										<select class="form-control form-select form-select-sm" id="filter_status" style="width: 150px; font-size: 12px;">
											<option value=""><%= __('table.all') %></option>
											<option value="1"><%= __('table.available') %></option>
											<option value="2"><%= __('table.occupied') %></option>
											<option value="4"><%= __('table.reserved') %></option>
											<option value="3"><%= __('table.not_available') %></option>
										</select>
									</div>
									<div class="col-auto ms-auto">
										<label class="form-label fw-bold mb-0" style="font-size: 12px;"><%= __('table.pagination.search') %>:</label>
										<input type="text" class="form-control form-control-sm" id="search_input" placeholder="<%= __('table.pagination.search_placeholder') %>" style="width: 200px; font-size: 12px;">
									</div>
								</div>
							</div>

							<div class="card-body">
								<!-- Cards Container -->
								<div id="tableCardsContainer" class="row g-3">
									<!-- Cards will be dynamically inserted here -->
								</div>
								
								<!-- Empty State -->
								<div id="emptyState" class="text-center py-5" style="display: block;">
									<i class="fa fa-table fa-3x text-muted mb-3"></i>
									<p class="text-muted">No tables found. Click "+ New Table" to add one.</p>
								</div>
								
								<!-- Pagination -->
								<div class="d-flex justify-content-between align-items-center mt-4">
									<div id="paginationInfo" class="text-muted" style="font-size: 12px;"></div>
									<nav>
										<ul class="pagination pagination-sm mb-0" id="paginationControls">
											<!-- Pagination buttons will be inserted here -->
										</ul>
									</nav>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>


			<!-- ============================================ -->
			<!-- MODALS -->
			<!-- ============================================ -->
			<%- include ('../modals/table/newTable'); %>
			<%- include ('../modals/table/editTable'); %>
			<%- include ('../modals/table/transactionHistory'); %>
			<%- include ('../modals/table/transactionHistory'); %>

			<!-- ============================================ -->
			<!-- FOOTER -->
			<!-- ============================================ -->
			<%- include ('../partials/footer'); -%>

			<!-- Translations passed via data attribute to avoid linter issues -->
			<div id="manageTableTranslations" 
				data-success="<%- __('table.success') %>"
				data-error="<%- __('table.error') %>"
				data-table-created-successfully="<%- __('table.table_created_successfully') %>"
				data-table-updated-successfully="<%- __('table.table_updated_successfully') %>"
				data-table-deleted-successfully="<%- __('table.table_deleted_successfully') %>"
				data-failed-to-create-table="<%- __('table.failed_to_create_table') %>"
				data-failed-to-update-table="<%- __('table.failed_to_update_table') %>"
				data-failed-to-delete-table="<%- __('table.failed_to_delete_table') %>"
				data-failed-to-load-tables="<%- __('table.failed_to_load_tables') %>"
				data-delete-confirmation-title="<%- __('table.delete_confirmation_title') %>"
				data-delete-confirmation-text="<%- __('table.delete_confirmation_text') %>"
				data-delete-confirm-button="<%- __('table.delete_confirm_button') %>"
				data-all="<%- __('table.all') %>"
				data-available="<%- __('table.available') %>"
				data-occupied="<%- __('table.occupied') %>"
				data-reserved="<%- __('table.reserved') %>"
				data-not-available="<%- __('table.not_available') %>"
				data-unknown="<%- __('table.unknown') %>"
				data-pagination-showing="<%- __('table.pagination.showing') %>"
				data-pagination-to="<%- __('table.pagination.to') %>"
				data-pagination-of="<%- __('table.pagination.of') %>"
				data-pagination-entries="<%- __('table.pagination.entries') %>"
				data-pagination-previous="<%- __('table.pagination.previous') %>"
				data-pagination-next="<%- __('table.pagination.next') %>"
				data-pagination-search="<%- __('table.pagination.search') %>"
				data-pagination-search-placeholder="<%- __('table.pagination.search_placeholder') %>"
				style="display: none;"></div>

			<!-- Table context for admin branch checks -->
			<div id="tableContextData"
				data-permissions="<%= (typeof permissions !== 'undefined' && permissions !== null) ? permissions : 0 %>"
				data-branch-id="<%= (typeof branch_id !== 'undefined' && branch_id !== null) ? branch_id : '' %>"
				style="display: none;"></div>

			<!-- ============================================ -->
			<!-- SCRIPTS -->
			<!-- ============================================ -->
			<script>
				console.log('=== Script tag reached ===');
				console.log('About to load manageTable.js');
				
				// Test if file exists by trying to load it
				var script = document.createElement('script');
				script.src = '/assets/js/functions/manageTable.js?v=' + new Date().getTime();
				script.onload = function() {
					console.log('✓ manageTable.js loaded successfully');
				};
				script.onerror = function() {
					console.error('✗ ERROR: Failed to load manageTable.js');
					console.error('Check Network tab for 404 error');
				};
				document.head.appendChild(script);
			</script>

			<style>
				.card-body {
					overflow-x: auto;
				}

				/* Pure Table Image - No Card Style */
				.table-card {
					border: none;
					border-radius: 0;
					height: 100%;
					min-height: 280px;
					background-image: url('/assets/images/Table6.webp');
					background-size: cover;
					background-position: center;
					background-repeat: no-repeat;
					box-shadow: none;
					overflow: visible;
					position: relative;
					display: flex;
					flex-direction: column;
					transition: transform 0.3s ease, filter 0.3s ease;
				}

				.table-card:hover {
					transform: scale(1.02);
					filter: brightness(1.05);
				}

				.table-card-header {
					background: transparent;
					color: #DB5363;
					padding: 0;
					display: flex;
					justify-content: center;
					align-items: center;
					position: absolute;
					top: 15px;
					left: 0;
					right: 0;
					z-index: 2;
					flex-direction: column;
					gap: 8px;
				}

				.table-card-header .table-number-badge {
					text-align: center;
				}

				.table-card-header .badge {
					text-align: center;
					margin: 0 auto;
				}

				.table-card-body {
					padding: 0;
					background: transparent;
					position: absolute;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					z-index: 1;
					display: flex;
					justify-content: center;
					align-items: center;
					flex-direction: column;
				}

				.table-card-info {
					display: flex;
					flex-direction: column;
					gap: 16px;
				}

				.table-card-info-item {
					display: flex;
					justify-content: center;
					align-items: center;
					padding: 4px 8px;
					margin-bottom: 6px;
					background: transparent;
					border-radius: 0;
					box-shadow: none;
					gap: 4px;
					position: relative;
					width: fit-content;
					margin-left: auto;
					margin-right: auto;
					text-align: center;
				}

				.table-card-info-item:first-child {
					margin-bottom: 15px;
					margin-top: -5px;
					justify-content: center;
					margin-left: auto;
					margin-right: auto;
				}

				/* Push capacity below the table plant graphic */
				.table-card-info-item.table-card-capacity {
					margin-top: 80px;
					margin-bottom: 0;
				}

				.table-card-info-item:last-child {
					margin-bottom: 0;
				}

				.table-card-info-label {
					font-weight: 600;
					color: #2c3e50;
					font-size: 12px;
					display: inline-flex;
					align-items: center;
					gap: 1px;
					position: relative;
					z-index: 2;
					text-shadow: 0 1px 3px rgba(255, 255, 255, 0.95), 0 1px 1px rgba(0, 0, 0, 0.1);
					white-space: nowrap;
					transition: all 0.2s ease;
				}

				.table-card-info-label i {
					color: #DB5363;
					font-size: 14px;
					text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
					transition: all 0.2s ease;
				}

				.table-card-info-item:hover .table-card-info-label {
					transform: translateY(-1px);
				}

				.table-card-info-item:hover .table-card-info-label i {
					transform: scale(1.1);
					color: #c82333;
				}

				/* Position date created icon more inside the table - compact */
				.table-card-info-item:last-child {
					gap: 2px;
					padding: 2px 6px;
				}

				.table-card-info-item:last-child .table-card-info-label {
					gap: 1px;
					font-size: 11px;
				}

				.table-card-info-item:last-child .table-card-info-label i.fa-calendar {
					font-size: 13px;
					margin-right: 2px;
				}

				.table-card-info-item:last-child .table-card-info-value {
					font-size: 11px;
					margin-left: 2px;
				}

				.table-card-info-value {
					color: #1a1a1a;
					font-size: 14px;
					font-weight: 700;
					position: relative;
					z-index: 2;
					text-shadow: 0 1px 3px rgba(255, 255, 255, 0.95), 0 1px 1px rgba(0, 0, 0, 0.1);
					transition: all 0.2s ease;
				}

				.table-card-info-item:hover .table-card-info-value {
					color: #000;
					transform: scale(1.05);
				}

				.table-card-actions {
					padding: 0;
					display: flex;
					justify-content: center;
					gap: 10px;
					background: transparent;
					position: absolute;
					bottom: 15px;
					left: 50%;
					transform: translateX(-50%);
					z-index: 2;
				}

				.table-card-actions .btn {
					border-radius: 8px;
					padding: 8px 14px;
					font-weight: 600;
					font-size: 12px;
					transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
					box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
					border: none;
				}

				.table-card-actions .btn:hover {
					transform: translateY(-3px) scale(1.05);
					box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
				}

				.table-card-actions .btn:active {
					transform: translateY(-1px) scale(1.02);
				}

				.table-card-actions .btn-danger {
					background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
					border: none;
				}

				.table-card-actions .btn-info {
					background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
					border: none;
				}

				.table-card-actions .btn-success {
					background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
					border: none;
				}

				.table-number-badge {
					font-size: 20px;
					font-weight: 700;
					letter-spacing: 0.5px;
					text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3), 0 0 10px rgba(219, 83, 99, 0.2);
					position: relative;
					z-index: 3;
					color: #DB5363;
					transition: all 0.3s ease;
				}

				.table-card:hover .table-number-badge {
					transform: scale(1.05);
					text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 15px rgba(219, 83, 99, 0.3);
				}

				/* Premium Round status badges */
				.table-card-header .badge {
					border-radius: 50px;
					padding: 6px 12px;
					font-size: 10px;
					font-weight: 600;
					letter-spacing: 0.5px;
					box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), 0 0 15px rgba(0, 0, 0, 0.1);
					text-transform: uppercase;
					position: relative;
					z-index: 3;
					backdrop-filter: blur(10px);
					transition: all 0.3s ease;
				}

				.table-card:hover .table-card-header .badge {
					transform: scale(1.05);
					box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 0 20px rgba(0, 0, 0, 0.15);
				}

				/* Badge color enhancements */
				.table-card-header .badge.bg-success {
					background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
				}

				.table-card-header .badge.bg-warning {
					background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%) !important;
				}

				.table-card-header .badge.bg-info {
					background: linear-gradient(135deg, #17a2b8 0%, #0dcaf0 100%) !important;
				}

				.table-card-header .badge.bg-danger {
					background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
				}

				/* Branch badge should be transparent */
				.table-card-header .badge.bg-secondary {
					background: transparent !important;
					box-shadow: none;
					color: #333;
					
				}

				.bg-light {
					background-color: #f8f9fa !important;
				}

				.border-bottom {
					border-bottom: 2px solid #dee2e6 !important;
				}

				.form-label.fw-bold {
					font-size: 12px;
					color: #495057;
					margin-bottom: 5px;
				}

				#filter_status, #search_input {
					font-size: 12px;
				}

				/* Premium Empty State */
				#emptyState {
					padding: 60px 20px;
					background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
					border-radius: 12px;
					border: 2px dashed #dee2e6;
				}

				#emptyState i {
					opacity: 0.3;
					animation: pulse 2s ease-in-out infinite;
				}

				@keyframes pulse {
					0%, 100% {
						opacity: 0.3;
						transform: scale(1);
					}
					50% {
						opacity: 0.5;
						transform: scale(1.05);
					}
				}

				#emptyState p {
					font-size: 16px;
					color: #6c757d;
					margin-top: 16px;
					font-weight: 500;
				}

				/* Premium Filter Section */
				.card-body.border-bottom.bg-light {
					background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%) !important;
					border-bottom: 1px solid rgba(219, 83, 99, 0.1) !important;
					padding: 16px 20px;
				}

				#filter_status, #search_input {
					border-radius: 8px;
					border: 1px solid #dee2e6;
					transition: all 0.3s ease;
				}

				#filter_status:focus, #search_input:focus {
					border-color: #DB5363;
					box-shadow: 0 0 0 3px rgba(219, 83, 99, 0.1);
					outline: none;
				}

				/* Premium Pagination */
				.pagination .page-link {
					border-radius: 8px;
					margin: 0 4px;
					border: 1px solid #dee2e6;
					color: #495057;
					transition: all 0.3s ease;
				}

				.pagination .page-link:hover {
					background: #DB5363;
					color: white;
					border-color: #DB5363;
					transform: translateY(-2px);
					box-shadow: 0 4px 8px rgba(219, 83, 99, 0.2);
				}

				.pagination .page-item.active .page-link {
					background: linear-gradient(135deg, #DB5363 0%, #C94454 100%);
					border-color: #DB5363;
					box-shadow: 0 4px 12px rgba(219, 83, 99, 0.3);
				}

				/* Responsive adjustments */
				@media (max-width: 768px) {
					.table-card {
						margin-bottom: 15px;
					}
					
					.table-card-header {
						padding: 14px 16px;
					}
					
					.table-card-body {
						padding: 20px 16px;
					}
				}

				/* Transaction History Modal Scroll Fix */
				#modal-transaction_history .modal-body {
					overflow-x: auto;
					max-height: 70vh;
				}

				#modal-transaction_history .table-responsive {
					overflow-x: auto;
					-webkit-overflow-scrolling: touch;
					display: block;
					width: 100%;
				}

				#modal-transaction_history table {
					min-width: 800px;
					width: 100%;
				}

				/* Custom Scrollbar Styling - #DB5363 */
				#modal-transaction_history .modal-body::-webkit-scrollbar,
				#modal-transaction_history .table-responsive::-webkit-scrollbar {
					width: 12px;
					height: 12px;
				}

				#modal-transaction_history .modal-body::-webkit-scrollbar-track,
				#modal-transaction_history .table-responsive::-webkit-scrollbar-track {
					background: #f1f1f1;
					border-radius: 10px;
				}

				#modal-transaction_history .modal-body::-webkit-scrollbar-thumb,
				#modal-transaction_history .table-responsive::-webkit-scrollbar-thumb {
					background: #DB5363;
					border-radius: 10px;
				}

				#modal-transaction_history .modal-body::-webkit-scrollbar-thumb:hover,
				#modal-transaction_history .table-responsive::-webkit-scrollbar-thumb:hover {
					background: #C94454;
				}

				/* Firefox Scrollbar */
				#modal-transaction_history .modal-body,
				#modal-transaction_history .table-responsive {
					scrollbar-width: thin;
					scrollbar-color: #DB5363 #f1f1f1;
				}

				/* Fix tooltip overlap with modal */
				.modal.show ~ .tooltip,
				.modal.show .tooltip {
					display: none !important;
					visibility: hidden !important;
					opacity: 0 !important;
				}

				.tooltip {
					z-index: 9999;
				}

				.modal {
					z-index: 1050;
				}

				.modal-backdrop {
					z-index: 1040;
				}
			</style>

